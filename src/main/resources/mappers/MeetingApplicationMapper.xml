<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hj.lunchExpedition.meeting.mapper.MeetingApplicationMapper">

    <!-- 특정 모임 신청자 목록 조회 -->
    <select id="selectApplicantsByMeeting" parameterType="int"
            resultType="com.hj.lunchExpedition.meeting.dto.MeetingApplicantRDto">
        SELECT
        ma.id,
        ma.applicant_id AS applicantId,
        u.nickname,
        u.self_introduction AS selfIntroduction,
        ma.status,
        ma.applied_at AS appliedAt,
        ma.responded_at AS respondedAt
        FROM meeting_application ma
        LEFT JOIN user u ON ma.applicant_id = u.id
        WHERE ma.meeting_id = #{meetingId}
        ORDER BY ma.applied_at DESC
    </select>

    <!-- 신청 승인/거절 업데이트 -->
    <update id="updateApplicationStatus" parameterType="com.hj.lunchExpedition.meeting.dto.UpdateApplicationStatusQDto">
        UPDATE meeting_application
        SET
        status = #{status},
        responded_at = NOW()
        WHERE meeting_id = #{meetingId}
        AND applicant_id = #{applicantId}
        AND status = 'PENDING'
    </update>

</mapper>
